<%# I am making a main wrapper of my page here by making a custom class for styling it in css %>
<div class="container home-page-container">

  <%# this is where we see chat about: and the title of the current problem %>
  <h1 class="chat-title">Chat about: <%= @chat.problem.title %></h1>

  <h2 class="messages-heading">Your conversation:</h2>

  <%# this is the wrapper where I see the chat %>

  <%# render_markdown converts the weird text into HTML %>
  <div id="messages" class="messages-list">
    <%= render "messages/messages", messages: @chat.messages.order(:created_at) %>
  <div class="messages-list">
    <% @chat.messages.order(:created_at).each do |message| %>
      <div class="message <%= message.role %>">
        <p class="message-role"><strong><%= message.role.capitalize %>:</strong></p>

        <p class="message-content"><%= raw(render_markdown(message.content)) %></p>
        <small class="message-time"><%= message.created_at.strftime("%d %b %Y %H:%M") %></small>
      </div>
    <% end %>
  </div>


  <div id="loader">
    <%= render "messages/loading" %>
  </div>

  <%= link_to new_problem_path, class: "back-link" do %>
    <i class="fa fa-arrow-left"></i> Back
  <% end %>

  <div id="message-form" class="new-message-form">
    <%= render "messages/form", chat: @chat, message: @message %>
  <div id="new_message_container" class="new-message-form">
    <%= simple_form_for [@chat, @message] do |f| %>
      <% prefilled = @chat.messages.any? ? "" : @chat.problem.content %>
      <%= f.input :content, label: "Ask a question", required: true, input_html: { value: prefilled } %>
      <%= f.button :submit, 'Ask your Mental health Assistant', class: 'btn btn-primary submit-btn' %>

    <% end %>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.new-message-form form'); // Adjust this selector if your form structure is different
    form.addEventListener('submit', function() {
      document.getElementById('loading').style.display = 'block'; // Show loading indicator
    });
  });
</script>
